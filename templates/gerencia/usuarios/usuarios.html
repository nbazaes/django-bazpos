{% extends 'index.html' %}
{% block index_content %} 
{% endblock %}

{% block contenido %}
{% load static %}

<div class="container-fluid">
    <h1 class="h3 mb-2 text-gray-800">Lista de usuarios</h1>
<div class="mt-3 mb-3 text-end">
    {% if perms.auth.add_user %}
    <a href="{% url 'crearUsuario' %}" class="btn btn-outline-primary">Crear usuario</a>
    {% endif %}
</div>
<form method="post">
    {% csrf_token %}
    <div class="input-group mt-3 mb-3">
        <span class="input-group-text">Nombre</span>
        {{ form.texto }}
        <input type="submit" value="Buscar" class="btn btn-primary" />
    </div>
</form>
{% if lista %} 
<div class="table-responsive mt-3">
    <table class="table table-bordered table-hover">
        <thead class="table-primary">
            <tr>
                <th>Nombre de usuario</th>
                <th>Nombre</th>
                <th>Apellido</th>
                <th>Grupo</th>
                <th>Último acceso</th>
                <th>Fecha registro</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            {% for l in lista %}
            <tr>
                <td>{{ l.username }}</td>
                <td>{{ l.first_name }}</td>
                <td>{{ l.last_name }}</td>
                <td>{% for group in l.groups.all %} 
                    {{ group.name }}{% if not forloop.last %}, {% endif %} 
                    {% endfor %}</td>
                <td>{{ l.last_login }}</td>
                <td>{{ l.date_joined }}</td>

                <td nowrap>
                    {% if perms.auth.change_user %}
                    <a href="{% url 'editarUsuario' l.username %}" class="btn btn-primary">Editar</a>
                    {% endif %}
                    {% if perms.auth.delete_user %}
                    <a href="#" onclick="eliminar('{{ l.username }}')" class="btn btn-danger">Eliminar</a>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <script>
        const eliminar = (id) => {
            Swal.fire({
                title: '¿Esta seguro de eliminar el usuario',
                text: 'No podrás revertir los cambios',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                confirmButtonText: 'Eliminar'
            }).then((result) => {
                if(result.isConfirmed)
                    window.location.href = '/gerencia/usuarios/eliminarusuario/' + id
            })
        }
    </script>
</div>
</div>

{% else %}
<p class="alert alert-warning display-5">No hay datos de usuarios</p>
{% endif %}

{% comment %}     <div class="container">
        <h2>Registro</h2>
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-success" role="alert">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
        <form method="POST">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit" class="btn btn-primary">Registrarse</button>
        </form>
    </div> {% endcomment %}
{% endblock %}
